# 什么是慢启动

慢启动是 TCP 连接建立后传输数据的启动策略。

摘自一段描述：

> 最初 TCP 的实现方式是在连接建立之后便会向网络传输大尺寸的数据包。

> 假设当网络出现问题，网络中的路由器会积攒很多类似大尺寸的数据包，导致这些路由器的存储空间被耗尽，从而发生了拥塞。

因此，现在的 TCP 协议规定当连接建立后，应当先发送小尺寸的数据包，发送发根据接收方接收数据的速度去改变发送的数据量。

但是这种变化的数据量不会无限制地增长，会有阈值。当发送方发送的数据量达到这个阈值，那么发送的数据量会趋于稳定，进入高速传输阶段。

以上的策略就是「慢启动」，简短来说就是慢启动是在传输开始时使用慢速传输，逐渐加快，最终达到高速。

而 TCP 协议在建立连接之处，发送方发送的数据量的增长是需要根据接收方确认的接收速度有关的，是以**指数级**的增长方式提高传输的数据量。

但是有两种情况会导致增长速率的改变：

1. 当发生数据包丢失事件；
2. 当发送的数据量达到预先设定的阈值；

第一种情况的发生时，TCP 协议的发送发会认为当前网络产生了阻塞，会采取措施减轻网络拥挤；

> _发送方如何知道网络拥塞了呢？_

发送方发送一些报文段时，如果发送方没有在时间间隔内收到接收方的确认报文段，则就可以人为网络出现了拥塞。

第二种情况发生时，TCP 会改变增长速率为线性增长，每经过一个 RTT 窗口增长一个段。

这里面还涉及到了一些概念：

1. 慢启动为 TCP 的发送方增加了一个新的窗口，叫做「拥塞窗口」(cwnd)，这个窗口是 TCP 的拥塞控制的主要依赖；
2. TCP 的接收方存在「接收窗口」(rwnd)，用于流量控制；
3. 基于考虑**拥塞控制**和**流量控制**两个方面的内容，TCP 真正的发送窗口是 min(cwnd, rwnd)；

拥塞窗口被初始化为 1 个报文段（即另一端接收窗口的报文段大小）。每收到一个 `ACK`，拥塞窗口就增加一个报文段（cwnd 以字节为单位，但是慢启动以报文段大小为单位进行增加）。

发送方取拥塞窗口与接收窗口中的最小值作为发送上限。拥塞窗口是发送方使用的流量控制，而接收窗口则是接收方使用的流量控制。

发送方开始时发送 1 个报文段，然后等待 `ack`。当收到该 `ack` 时，拥塞窗口从 1 个报文增加为 2 个报文，即可以发送两个报文段。

当收到这 2 个报文段的 `ack` 时，拥塞窗口就增加为 4 个报文。这是一种指数增加的关系。
